# Development Workflow

## Overview

This document outlines our development workflow using feature branches, preview deployments, and safe deployment practices.

## Core Principles

1. **One Source of Truth**: `main` branch = Production
2. **Test Before Deploy**: Always test on preview deployments
3. **Feature Isolation**: Each feature gets its own branch
4. **Clean History**: Delete branches after merging

## Deployment Pipeline

```
Feature Branch ‚Üí Preview Deployment ‚Üí Testing ‚Üí PR ‚Üí Main ‚Üí Production
```

### Environments

| Environment | Source | URL | Purpose |
|------------|--------|-----|----------|
| **Production** | `main` branch | https://life-dashboard-ri1t.vercel.app | Live application |
| **Preview** | Feature branches | Auto-generated by Vercel | Testing changes |
| **Local** | Developer machine | http://localhost:3000 | Optional development |

## Standard Workflow

### 1. Starting New Work

```bash
# Create feature branch from main
feature/[feature-name]

Examples:
- feature/retry-logic
- feature/outlook-calendar
- feature/error-dashboard
- fix/token-refresh-bug
```

### 2. Development Process

**Claude's Process:**
1. Create feature branch: `github:create_branch`
2. Write and test code changes
3. Push files to feature branch: `github:push_files`
4. Create PR when ready: `github:create_pull_request`

**What Happens Automatically:**
1. Vercel detects new commit on feature branch
2. Vercel builds the branch
3. Vercel creates preview deployment
4. Vercel comments on commit/PR with preview URL
5. Preview URL is live within 30-60 seconds

### 3. Testing on Preview

**You (Developer) will:**
1. Click the preview URL from Vercel bot comment
2. Test the new feature thoroughly
3. Verify it works as expected
4. Check for any bugs or issues

**Preview URL Format:**
```
https://life-dashboard-git-[branch-name]-mllivingston.vercel.app

Example:
https://life-dashboard-git-feature-retry-logic-mllivingston.vercel.app
```

### 4. Merge to Production

**If tests pass:**
1. Review the PR code changes
2. Merge the PR (via GitHub UI)
3. Vercel auto-deploys to production
4. Delete the feature branch

**If tests fail:**
1. Report issues to Claude
2. Claude pushes fixes to same branch
3. Vercel updates preview automatically
4. Test again
5. Repeat until working

## Workflow Decisions

### When to Use Feature Branches

**‚úÖ ALWAYS use feature branch for:**
- New features (calendar integration, retry logic, etc.)
- Bug fixes that touch core functionality
- Refactoring existing code
- Database schema changes
- API changes
- Authentication changes

**‚ö° MAY use direct main for:**
- Documentation updates (README, docs/*.md)
- Typo fixes in comments
- Dependency updates (with caution)

**‚ùå NEVER push to main:**
- Untested code
- Breaking changes
- Experimental features

## Safety Checklist

Before merging to main:
- [ ] Tested on preview deployment
- [ ] No console errors
- [ ] Authentication still works
- [ ] Calendar integration still works
- [ ] No data loss or corruption
- [ ] Reviewed code changes

## Branch Naming Conventions

```
feature/[name]    - New features
fix/[name]        - Bug fixes
refactor/[name]   - Code refactoring
docs/[name]       - Documentation only
chore/[name]      - Tooling, dependencies
```

## Example Session Flow

### Session Start
```
Claude: "What should we work on today?"
You: "Let's add retry logic to the calendar API"

Claude: Creates feature/retry-logic branch
Claude: Writes code and pushes to branch
Claude: "Preview URL: https://life-dashboard-git-feature-retry-logic-..."

You: Test the preview URL
You: "Looks good!"

Claude: Creates PR
You: Merge PR on GitHub
Vercel: Deploys to production

Claude: "Production updated! ‚úÖ"
```

## Emergency Rollback

If production breaks:

1. **Quick Fix (Preferred):**
   - Create `fix/emergency-[issue]` branch
   - Make fix
   - Test on preview
   - Merge immediately

2. **Revert (Nuclear Option):**
   - Go to GitHub ‚Üí Commits
   - Find last working commit
   - Click "Revert"
   - Merge revert PR

## Vercel Configuration

**Current Setup:**
- Auto-deploys from `main` to production
- Auto-creates preview deployments for all branches
- Environment variables synced to all deployments

**No configuration changes needed** - this works out of the box!

## Preview Deployment Features

**What's Included:**
- ‚úÖ Same database (Supabase production)
- ‚úÖ Same environment variables
- ‚úÖ Same authentication
- ‚úÖ Same Google Calendar connection
- ‚úÖ Real-time updates

**What's Different:**
- Different URL (preview URL vs production URL)
- Isolated from production traffic
- Automatically deleted after branch is merged/deleted

## Tips & Best Practices

1. **Keep Branches Short-Lived**
   - Aim to merge within 1-2 sessions
   - Don't let branches sit for days

2. **Test Thoroughly**
   - Click through all features
   - Check browser console for errors
   - Test on mobile if relevant

3. **Write Good PR Descriptions**
   - What changed?
   - Why did it change?
   - How to test it?

4. **Delete Merged Branches**
   - Keeps repo clean
   - Prevents confusion
   - Vercel deletes preview automatically

5. **One Feature Per Branch**
   - Easier to review
   - Easier to rollback if needed
   - Clearer git history

## Common Issues & Solutions

### "Preview deployment failed"
- Check Vercel dashboard for build logs
- Usually a syntax error or missing dependency
- Claude can fix and re-push to same branch

### "Preview works but production breaks"
- Check environment variables are synced
- Verify database migrations ran
- Check Vercel production logs

### "Can't find preview URL"
- Check GitHub PR for Vercel bot comment
- Check Vercel dashboard ‚Üí Deployments
- Preview appears within 60 seconds of push

## Monitoring

**Health Check:**
- Production: https://life-dashboard-ri1t.vercel.app/api/health
- Preview: https://[preview-url]/api/health

**Always check health after deployment!**

## Next Steps

Now that this workflow is documented:
1. ‚úÖ Created feature branch for this documentation
2. ‚è≥ Waiting for preview deployment
3. ‚è≥ Test the preview
4. ‚è≥ Merge this PR
5. üöÄ Use this workflow for all future changes!

---

**Last Updated:** October 30, 2025
**Status:** Active and enforced